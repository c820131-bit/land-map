<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íˆ¬ìì§€ë„ PRO</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7e60f6a42602355b925c66ea6db3bd87&libraries=clusterer"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        
        #map { width: 100%; height: 100vh; }
        
        .sidebar {
            position: absolute; top: 20px; left: 20px; width: 340px;
            background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
            border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            padding: 25px; z-index: 1000;
        }
        
        .sidebar h1 {
            font-size: 24px; margin-bottom: 5px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        
        .sidebar p { font-size: 13px; color: #666; margin-bottom: 20px; }
        
        .stats {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: white; padding: 15px; border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .stat-box.blue { border-left: 3px solid #667eea; }
        .stat-box.purple { border-left: 3px solid #9b59b6; }
        .stat-box.green { border-left: 3px solid #2ecc71; }
        .stat-box.red { border-left: 3px solid #e74c3c; }
        
        .stat-label { font-size: 11px; color: #999; margin-bottom: 5px; }
        .stat-value { font-size: 24px; font-weight: bold; color: #333; }
        
        .status {
            padding: 12px; background: #f0f4ff; border-radius: 8px;
            font-size: 13px; color: #667eea; text-align: center;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="sidebar">
        <h1>ğŸ—ºï¸ íˆ¬ìì§€ë„ PRO</h1>
        <p>ìŠ¤ë§ˆíŠ¸í•œ ë¶€ë™ì‚° íˆ¬ì í”Œë«í¼</p>
        
        <div class="stats">
            <div class="stat-box blue">
                <div class="stat-label">ê²½ë§¤</div>
                <div class="stat-value" id="auction">0</div>
            </div>
            <div class="stat-box purple">
                <div class="stat-label">ê³µë§¤</div>
                <div class="stat-value" id="public">0</div>
            </div>
            <div class="stat-box green">
                <div class="stat-label">ë³´ìƒí† ì§€</div>
                <div class="stat-value" id="land">0</div>
            </div>
            <div class="stat-box red">
                <div class="stat-label">í´ë¦¬ê³¤</div>
                <div class="stat-value" id="polygon">0</div>
            </div>
        </div>
        
        <div class="status" id="status">ì§€ë„ ë¡œë”© ì¤‘...</div>
    </div>

    <script>
        console.log('ğŸš€ íˆ¬ìì§€ë„ ì‹œì‘!');
        
        let map, clusterer;
        let markers = [];
        let polygons = [];
        
        // 1. ì§€ë„ ìƒì„±
        function initMap() {
            console.log('ğŸ“ ì§€ë„ ì´ˆê¸°í™” ì¤‘...');
            
            try {
                const container = document.getElementById('map');
                const options = {
                    center: new kakao.maps.LatLng(37.2636, 127.0286),
                    level: 9
                };
                
                map = new kakao.maps.Map(container, options);
                console.log('âœ… ì§€ë„ ìƒì„± ì™„ë£Œ!');
                
                // í´ëŸ¬ìŠ¤í„°ëŸ¬ ìƒì„±
                clusterer = new kakao.maps.MarkerClusterer({
                    map: map,
                    averageCenter: true,
                    minLevel: 6
                });
                console.log('âœ… í´ëŸ¬ìŠ¤í„°ëŸ¬ ìƒì„± ì™„ë£Œ!');
                
                document.getElementById('status').textContent = 'âœ… ì§€ë„ ë¡œë”© ì™„ë£Œ!';
                document.getElementById('status').style.background = '#e8f5e9';
                document.getElementById('status').style.color = '#2ecc71';
                
                // 2. ë§ˆì»¤ ì¶”ê°€
                addMarkers();
                
            } catch (error) {
                console.error('âŒ ì§€ë„ ìƒì„± ì‹¤íŒ¨:', error);
                document.getElementById('status').textContent = 'âŒ ë¡œë”© ì‹¤íŒ¨: ' + error.message;
                document.getElementById('status').style.background = '#ffebee';
                document.getElementById('status').style.color = '#e74c3c';
            }
        }
        
        // 2. ë§ˆì»¤ ì¶”ê°€
        function addMarkers() {
            console.log('ğŸ“Œ ë§ˆì»¤ ìƒì„± ì¤‘...');
            
            const data = [
                { type: 'auction', name: 'ê²½ë§¤-í‰íƒ', lat: 37.0719, lng: 127.0769, price: '1.2ì–µ' },
                { type: 'auction', name: 'ê²½ë§¤-í‰íƒ2', lat: 37.0842, lng: 127.0534, price: '1.6ì–µ' },
                { type: 'public', name: 'ê³µë§¤-í™”ì„±', lat: 37.2158, lng: 126.9451, price: '6400ë§Œ' },
                { type: 'public', name: 'ê³µë§¤-í™”ì„±2', lat: 37.1876, lng: 127.0842, price: '8000ë§Œ' },
                { type: 'auction', name: 'ê²½ë§¤-ìˆ˜ì›', lat: 37.2633, lng: 126.9782, price: '1.6ì–µ' },
                { type: 'land', name: 'ë³´ìƒ-í‰íƒ', lat: 37.0735, lng: 127.0754, price: '-' },
                { type: 'land', name: 'ë³´ìƒ-í™”ì„±', lat: 37.2145, lng: 126.9523, price: '-' }
            ];
            
            let aCount = 0, pCount = 0, lCount = 0;
            
            data.forEach((item, i) => {
                const pos = new kakao.maps.LatLng(item.lat, item.lng);
                
                // ìƒ‰ìƒ ê²°ì •
                let color = item.type === 'auction' ? '#667eea' : 
                           item.type === 'public' ? '#9b59b6' : '#2ecc71';
                
                // ë§ˆì»¤ ì´ë¯¸ì§€
                const markerImage = new kakao.maps.MarkerImage(
                    `data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="40"><circle cx="15" cy="15" r="12" fill="${color}" stroke="white" stroke-width="2"/></svg>`,
                    new kakao.maps.Size(30, 40)
                );
                
                const marker = new kakao.maps.Marker({
                    position: pos,
                    image: markerImage,
                    title: item.name
                });
                
                // ì¸í¬ìœˆë„ìš°
                const infowindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:10px;min-width:150px;">
                        <b>${item.name}</b><br>
                        <span style="color:#667eea;">ğŸ’° ${item.price}</span><br>
                        <button onclick="showPolygon(${item.lat},${item.lng})" 
                                style="margin-top:8px;padding:5px 12px;background:#667eea;color:white;border:none;border-radius:5px;cursor:pointer;">
                            ğŸ—ºï¸ ë•… ëª¨ì–‘ ë³´ê¸°
                        </button>
                    </div>`
                });
                
                kakao.maps.event.addListener(marker, 'click', () => {
                    infowindow.open(map, marker);
                });
                
                markers.push(marker);
                clusterer.addMarker(marker);
                
                // ì¹´ìš´íŠ¸
                if (item.type === 'auction') aCount++;
                if (item.type === 'public') pCount++;
                if (item.type === 'land') lCount++;
            });
            
            document.getElementById('auction').textContent = aCount;
            document.getElementById('public').textContent = pCount;
            document.getElementById('land').textContent = lCount;
            
            console.log(`âœ… ë§ˆì»¤ ${data.length}ê°œ ìƒì„± ì™„ë£Œ!`);
        }
        
        // 3. í´ë¦¬ê³¤ í‘œì‹œ
        function showPolygon(lat, lng) {
            console.log('ğŸ”· í´ë¦¬ê³¤ ìƒì„±:', lat, lng);
            
            // ê¸°ì¡´ í´ë¦¬ê³¤ ì œê±°
            polygons.forEach(p => p.setMap(null));
            polygons = [];
            
            // ì›í˜• í´ë¦¬ê³¤ ìƒì„±
            const center = new kakao.maps.LatLng(lat, lng);
            const path = [];
            const radius = 50; // 50ë¯¸í„°
            
            for (let i = 0; i < 20; i++) {
                const angle = (i / 20) * 2 * Math.PI;
                const pLat = lat + (radius / 111000) * Math.cos(angle);
                const pLng = lng + (radius / (111000 * Math.cos(lat * Math.PI / 180))) * Math.sin(angle);
                path.push(new kakao.maps.LatLng(pLat, pLng));
            }
            
            const polygon = new kakao.maps.Polygon({
                map: map,
                path: path,
                strokeWeight: 3,
                strokeColor: '#e74c3c',
                strokeOpacity: 0.8,
                fillColor: '#e74c3c',
                fillOpacity: 0.3
            });
            
            polygons.push(polygon);
            document.getElementById('polygon').textContent = polygons.length;
            
            // ì§€ë„ ì´ë™
            map.setCenter(center);
            map.setLevel(4);
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.onload = function() {
            console.log('ğŸŒ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');
            initMap();
        };
        
        // kakao ê°ì²´ í™•ì¸
        if (typeof kakao === 'undefined') {
            console.error('âŒ Kakao Maps API ë¡œë”© ì‹¤íŒ¨!');
            document.getElementById('status').textContent = 'âŒ ì¹´ì¹´ì˜¤ë§µ API ë¡œë”© ì‹¤íŒ¨';
        } else {
            console.log('âœ… Kakao Maps API ë¡œë”© ì™„ë£Œ');
        }
    </script>
</body>
</html>
